{{ $item := .item }}
{{ $has_attachments := partial "functions/has_attachments" $item }}

{{/* Skip rendering if item is invalid (e.g., called for start/end fragments) */}}
{{ if and $item.Title ($item.Content)}}

{{ $link := $item.Params.external_link | default $item.RelPermalink }}
{{ $target := "" }}
{{ if $item.Params.external_link }}
  {{ $link = $item.Params.external_link }}
  {{ $target = "target=\"_blank\" rel=\"noopener\"" }}
{{ end }}

<div class="w-full max-w-5xl mx-auto px-4 py-4">
  <div class="flex flex-col gap-y-4">

    <!-- Citation line -->
    <div class="text-sm leading-relaxed text-gray-700 dark:text-gray-300">
      {{/* APA Style */}}
      {{ if eq (site.Params.publications.citation_style | default "apa") "apa" }}

        <span class="article-metadata li-cite-author">
          {{ partial "page_metadata_authors" $item }}
        </span>
        ({{- $item.Date.Format "2006" -}}).
        <a href="{{ $link }}" {{ $target | safeHTMLAttr }}
           class="underline transition-colors duration-300 hover:text-primary-500 dark:hover:text-primary-400">
          {{ $item.Title }}
        </a>.
        {{ if $item.Params.publication_short }}
          {{- $item.Params.publication_short | markdownify -}}.
        {{ else if $item.Params.publication }}
          {{- $item.Params.publication | markdownify -}}.
        {{ end }}

      {{/* MLA Style */}}
      {{ else }}

        <span class="article-metadata li-cite-author">
          {{ partial "page_metadata_authors" $item }}.
        </span>
        <a href="{{ $link }}" {{ $target | safeHTMLAttr }}
           class="underline transition-colors duration-300 hover:text-primary-500 dark:hover:text-primary-400">
          {{ $item.Title }}
        </a>.
        {{ if $item.Params.publication_short }}
          {{- $item.Params.publication_short | markdownify -}},
        {{ else if $item.Params.publication }}
          {{- $item.Params.publication | markdownify -}},
        {{ end }}
        {{- $item.Date.Format "2006" -}}.

      {{ end }}
    </div>

    <!-- Attachments row (matches your other block's spacing) -->
    {{ if $has_attachments }}
      <div class="flex flex-wrap gap-3">
        {{ partial "page_links" (dict "page" $item "is_list" 1) }}
      </div>
    {{ end }}

  </div>
</div>

{{ end }}